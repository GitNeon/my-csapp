#### 32位x86架构

****

##### 1、寄存器的扩展

​	在16位处理器内，有8个通用寄存器：AX、BX、CX、DX、SI、DI、BP、SP。32位处理器在16位处理器上，扩充了这8个寄存器的长度。

图例：32位处理器内部的通用寄存器

![](.\imgs\21-32位寄存器扩充.png)

- 32位通用寄存器的高16位是不可独立使用的，低16位使用规则保持16位处理器兼容性。
- 可以在32位处理器上按照8086的实模式来运行，执行16位处理器上的软件。
- 32位处理器有自己的32位工作模式，在这种模式下，能够访问4GB(2^32)内存，充分发挥处理器性能。

图例：指令指针寄存器和段寄存器的扩展

![](F:\my-computer\my-csapp\3-x86-Assembly-1\note\imgs\22-指令指针寄存器和段寄存器的扩展.png)

- IA-32架构的处理器是基于分段模型的，32位处理器依然需要以段为单位访问。
- 平坦模型：只分一个段，段的基地址是0x00000000，段的长度（大小）是4GB，这是不分段的一种变通方案。
- 段选择器：
  - CS、SS、DS、ES中保存的不再是16位的逻辑段地址，而是段选择子，用于选择所访问的段。
  - 每个段寄存器还包括一个不可见部分，称为描述符高速缓存器，里面有段的基地址和各种访问属性。这部分内容程序不可访问，由处理器自动使用。

##### 2、基本工作模式

**实模式：**

- CPU 对内存的访问是直接的，没有复杂的内存保护机制。

- 实模式等同于8086模式，实模式下段的访问是随意的，没有任何保护措施。
- 16位保护模式是80286处理器提出的，在保护模式下，段寄存器中保存的不再是逻辑段地址，而是段选择子，真正的段地址位于段寄存器的描述符高速缓存中，是24位的。

**保护模式：**

- 采用分页、分段等机制来保护内存的访问，访问内存机制比较复杂。

- 80386是32位处理器，以及后续的32位处理器都兼容实模式，在刚加电时自动处于实模式，需要一番设置才能运行在保护模式下。
- 保护模式下，采用分段机制时，每个段的基地址是32位的，段内偏移量也是32位的，段的长度不受限制，可以访问多达4GB的内存。

##### 3、线性地址和分页

图例：线性地址和线性空间

![](.\imgs\23-线性地址和线性空间.png)

​	IA-32处理器上的每个任务都拥有4GB的虚拟内存空间，这是一段长4GB的平坦空间，就像一段平直的线段，因此叫线性地址空间。相应的，由段部件产生的地址，就对应着这条线段上的每个点，这就是线性地址。

**分页：**

- 将物理内存空间划分成逻辑上的页，页大小一般为4KB。使用页，可以简化内存管理。
- 当页功能开启时，段部件产生的地址不再是物理地址，而是线性地址，经过页部件转换才是物理地址。